import streamlit as st
import requests

st.set_page_config(page_title="Tutor Drones", page_icon="游띶")
st.title("游띶 Mi Tutor de Drones")

API_KEY = "AIzaSyAMnsCYE5JvPcWQ0up-goXmALEnbWr2jfQ"

pregunta = st.text_input("Haz tu pregunta sobre drones:")

if st.button("Consultar"):
    if pregunta:
        with st.spinner("Conectando con el experto..."):
            # Probamos con la versi칩n v1beta y el modelo pro, que es el m치s permisivo con el error 403
            url = f"https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key={API_KEY}"
            
            payload = {
                "contents": [{
                    "parts": [{"text": f"Eres un experto en drones en Espa침a. Responde de forma educativa a: {pregunta}"}]
                }]
            }
            
            try:
                res = requests.post(url, json=payload)
                if res.status_code == 200:
                    respuesta = res.json()['candidates'][0]['content']['parts'][0]['text']
                    st.success("춰Respuesta recibida!")
                    st.markdown(respuesta)
                else:
                    st.error(f"Error {res.status_code}: Acceso denegado por Google.")
                    st.info("Sugerencia: Si esto falla, intentaremos crear una API KEY nueva en un segundo.")
            except Exception as e:
                st.error(f"Error de conexi칩n: {e}")
